var Game29;(function(n){var r=angular.module("game29",["ngCookies","ui.bootstrap"]),i=function(){function i(n,t,i){this.$scope=n,this.$location=t,this.$cookies=i,this._game29=$.connection.game29,this.registerScopeWatches(),this.registerScopeHandlers(),this.registerClientCallbacks(),this.startHub(n)}return Object.defineProperty(i.prototype,"me",{get:function(){var t=this.$scope.me,i,r;return t?t:(i=this.$cookies.userEmail,r=this.$cookies.userName,null)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"room",{get:function(){var t=this.$scope.room,i;if(!t){if(i=this.$location.path().replace("/rooms/",""),!i)return null;t=new n.RoomInfo,t.Name=i,this.$scope.room=t}return t},enumerable:!0,configurable:!0}),i.prototype.registerScopeWatches=function(){var n=this;this.$scope.$watch("room.Name",function(t){t&&n.$location.path("/rooms/"+encodeURIComponent(t))}),this.$scope.$watch("me.Email",function(t){t&&(n.$cookies.userEmail=t)}),this.$scope.$watch("me.Name",function(t){t&&(n.$cookies.userName=t)})},i.prototype.registerScopeHandlers=function(){var n=this;this.$scope.closeJoinModal=function(){n.$scope.joinModal=!n.$scope.me.Name||!n.$scope.me.Email,n.$scope.joinRoomModal=!n.$scope.joinModal&&!n.room,n.$scope.joinModal||n.join(),n.$scope.joinRoomModal||n.joinRoom()},this.$scope.closeJoinRoomModal=function(){n.$scope.joinRoomModal=!n.$scope.room.Name,n.$scope.joinRoomModal||n.joinRoom()},this.$scope.leaveRoom=function(){n.leaveRoom(this.user)},this.$scope.leaveTeam=function(){t.log("leaveTeam called")},this.$scope.joinModalOptions={backdrop:!1,backdropClick:!1}},i.prototype.startHub=function(n){var t=this;$.connection.hub.start({transport:"longPolling"}).done(function(){t.me?t.join().done(function(){t.room?t.joinRoom():(n.joinRoomModal=!0,n.$apply())}):(n.joinModal=!0,n.$apply())})},i.prototype.registerClientCallbacks=function(){var n=this;this._game29.client.playerJoined=function(t){return n.playerJoined(t)},this._game29.client.playerLeftRoom=function(t){return n.playerLeftRoom(t)},this._game29.client.trumpOpened=function(){n.$scope.$apply()},this._game29.client.exceptionHandler=function(n){window.alert(n)}},i.prototype.playerJoined=function(){t.log("playerJoined")},i.prototype.playerLeftRoom=function(){t.log("playerLeftRoom called")},i.prototype.join=function(n){typeof n=="undefined"&&(n=this.me);var t=this;return this._game29.server.join(n).done(function(n){t.$scope.me=n,t.$scope.$apply()})},i.prototype.joinRoom=function(n){typeof n=="undefined"&&(n=this.room),this.$location.path("/rooms/"+encodeURIComponent(n.Name));var t=this;return this._game29.server.joinRoom(n).done(function(n){t.$scope.room=n,t.$scope.$apply()})},i.prototype.leaveRoom=function(n){return typeof n=="undefined"&&(n=this.me),null},i.prototype.resetRoom=function(){return null},i.prototype.showAllCards=function(n){return typeof n=="undefined"&&(n=!0),null},i.prototype.changeRoomTopic=function(){return null},i.prototype.changedMyCardValue=function(){return null},i.$inject=["$scope","$location","$cookies"],i}(),t;n.Game29Ctrl=i,r.controller("Game29Ctrl",i),t=function(){function n(){}return n.log=function(n){typeof window.console!="undefined"&&window.console.log(n)},n}()})(Game29||(Game29={}))